$O(1)$时间找到任意元素

# 链接法
**冲突时: 将元素插入到链表中**
假定元素数量为$N$, 槽位$M$, 负载因子 $\alpha = \frac{N}{M}$ 为常数
每个元素哈希到一个槽位$i$的概率是 $\frac{1}{M}$
对于第$j$个元素, 指示变量$X_j = 1$表示哈希到槽位$i$, 否则$X_j = 0$
槽位$i$的元素数量 $N_i=\sum_{j=1}^{N} X_j$
$$
E[X_j] = P(X_j=1)\times 1+P(X_j=0)\times 0 = P(X_j=1)=\frac{1}{M}
$$
$$
E[N_i] = \sum_{j=1}^{N} E[X_j] = \sum_{j=1}^{N} \frac{1}{M} = \frac{N}{M} = \alpha
$$

- 查找成功: $\Theta(1+\alpha)$
- 查找失败: $\Theta(1+\alpha)$

# 开放寻址法
**冲突时: 线性探测下一个槽位**
- 线性探查: $$h(k, i) = (h'(k) + i) \mod M$$
- 二次探查: $$h(k, i) = (h'(k) + c_1i+ c_2i^2) \mod M$$
- 双重哈希: $$h(k, i) = (h_1(k) + i \cdot h_2(k)) \mod M$$
	- $h_1(k)$: 主哈希函数
	- $h_2(k)$: 次哈希函数, $h_2(k) \neq 0$

复杂度$O(1)$
不成功搜索：一次不成功搜索期望的探查次数上限为：
$$E[\text{探查次数}]\leq\frac1{1-\alpha}$$
成功搜索：一次成功搜索期望的探查次数上限为：
$$E[\text{探查次数}]\leq\frac1\alpha\ln\frac1{1-\alpha}$$
## 证明
**目标：** 证明在开放寻址哈希表中，不成功查找（或插入）的平均时间复杂度为 $O(1)$。
**假设：**
1. 哈希表使用开放寻址法处理冲突。
2. 哈希表大小为 M，已存储元素数量为 N。负载因子 $\alpha = N/M < 1$。
3. 使用一个简化的概率模型：第 k 次探查（如果前 k−1 次都命中被占用槽位）命中被占用槽位的概率为 $\frac{N-k+1}{M-k+1}$。
4. 我们关心的是探查次数的**期望值** E。

**证明过程：**

进行一次不成功的查找或插入时，至少需要 1 次探查。如果第一次探查命中被占用槽位，则需要进行第二次探查；如果第二次依然命中被占用，则需要第三次，以此类推。

需要的探查次数的期望值 E 可以表示为：
$$
E = \sum_{k=1}^{\infty} P(\text{探查次数} \ge k)
$$
其中，$P(\text{探查次数} \ge k)$ 表示至少需要进行 k 次探查的概率。

根据假设，
$$
P(\text{探查次数} \ge 1) = 1
$$
$$
P(\text{探查次数} \ge 2) = P(\text{第一次命中占用}) = \frac{N}{M}
$$
$$
P(\text{探查次数} \ge 3) = P(\text{第一次命中占用}) \times P(\text{第二次命中占用} | \text{第一次命中占用}) = \frac{N}{M} \times \frac{N-1}{M-1}
$$
$$
P(\text{探查次数} \ge k) = \frac{N}{M} \times \frac{N-1}{M-1} \times \dots \times \frac{N-k+2}{M-k+2}
$$

因此，
$$
E = 1 + \frac{N}{M} + \frac{N}{M}\frac{N-1}{M-1} + \frac{N}{M}\frac{N-1}{M-1}\frac{N-2}{M-2} + \dots
$$

我们已知观察：对于 $1 \le i < N < M$，有
$$
\frac{N-i}{M-i} \le \frac{N}{M} = \alpha
$$
利用这个不等式，我们可以对期望值 E 进行放缩，得到一个上限：
$$
E \le 1 + \alpha + \alpha \times \alpha + \alpha \times \alpha \times \alpha + \dots
$$
$$
E \le 1 + \alpha + \alpha^2 + \alpha^3 + \dots
$$
这是一个公比为 $\alpha$ 的无穷等比数列（几何级数）。由于在开放寻址中 $N<M$，所以 $\alpha<1$。对于 $|\alpha|<1$ 的等比数列，其和为 $\frac{1}{1-\alpha}$。
$$
E \le \sum_{i=0}^{\infty} \alpha^i = \frac{1}{1-\alpha}
$$

**结论：**

不成功查找或插入所需的探查次数的期望值
$$
E \le \frac{1}{1-\alpha}
$$

在哈希表的平均情况分析中，我们通常通过再哈希等机制来保证负载因子 $\alpha$ 维持在一个小于 1 的常数范围内（例如，$\alpha \le 0.75$）。如果 $\alpha$ 是一个常数且小于 1，那么 $\frac{1}{1-\alpha}$ 也是一个常数。

因此，不成功查找或插入所需的探查次数的期望是常数级别的。这表明**哈希表（开放寻址法）的平均时间复杂度为 O(1)**。

# 加强
## 链表加强
插入的元素保持顺序, 常用于[[LRU]]缓存

## 数组加强
实现随机获取`key`, [[随机算法#O(1) 插入/删除数组元素]]