### 经典面试题：赛马问题（64匹马，8赛道，决出前4名）

#### **1. 问题描述**

  * **条件**：有 64 匹马，一个有 8 条赛道的赛场。
  * **限制**：每次比赛最多允许 8 匹马同时参赛。无法使用秒表等计时工具，只能得到每次比赛的相对名次。
  * **目标**：用最少的比赛次数，选出跑得最快的 4 匹马。

#### **2. 错误或非最优思路分析**

一个常见的想法是采用类似淘汰赛的方式：

1.  **第一轮**：64 进 32，需要 8 场比赛，每组取前 4。
2.  **第二轮**：32 进 16，需要 4 场比赛，每组取前 4。
3.  **第三轮**：16 进 8，需要 2 场比赛，每组取前 4。
4.  **第四轮**：8 进 4，需要 1 场比赛，决出最终 4 强。

> **总计：8 + 4 + 2 + 1 = 15 场比赛。**
>
> **结论**：这种方法虽然可行，但远非最优解。因为它没有充分利用每次比赛获得的“相对速度”信息。

-----

### **3. 最优解法步骤**

最优解的核心思想是\*\*“分组、淘汰、再决赛”\*\*，充分利用已知信息来排除尽可能多的马匹。

#### **第一步：全体初赛（8 场）**

1.  将 64 匹马随机分成 8 组（A, B, C, D, E, F, G, H），每组 8 匹。
2.  让每组分别进行比赛。

**至此，我们完成了 8 场比赛。**

  * **获得信息**：我们得到了每组内部的排名。例如，A组的排名为 A1 \> A2 \> A3 \> ... \> A8。
  * **初步淘汰**：在任何一组中排名第 5、6、7、8 的马，肯定不可能进入总排名的前 4，因为它们组内已经有 4 匹马比它们快。**因此，直接淘汰这 32 匹马 (8组 x 4匹)。**

#### **第二步：王者之战（第 9 场）**

1.  将第一步中每个小组的**冠军**（A1, B1, C1, D1, E1, F1, G1, H1）拿出来，进行一场比赛。
2.  假设本场比赛的排名为：**A1 \> B1 \> C1 \> D1 \> E1 \> F1 \> G1 \> H1**。

**至此，我们完成了第 9 场比赛。**

  * **获得信息与关键淘汰**：
    1.  **锁定第一名**： A1 是所有小组冠军中最快的，因此 **A1 毫无疑问是 64 匹马中的总冠军**。我们已经找到了 Top 4 中的一匹。
    2.  **大规模淘汰**：
          * 由于 D1 只排在第 4，连它都不可能进入前 3，那么比 D1 慢的 E1, F1, G1, H1 及其各自小组的所有马匹（E组、F组、G组、H组）就都不可能进入总排名前 4。全部淘汰。
          * 同理，C1 在本次比赛中排第 3，意味着至少有 A1 和 B1 比它快。因此，C组中排名第 3 及以后的马（C3, C4...）不可能进入总排名前 4。淘汰。
          * B1 在本次比赛中排第 2，意味着至少有 A1 比它快。因此，B组中排名第 4 及以后的马（B4, B5...）不可能进入总排名前 4。淘汰。

#### **第三步：候选马匹决赛（第 10 场，可能需要第 11 场）**

经过第 9 场比赛后，我们已经找到了总冠军 A1。剩下 Top 4 的 3 个席位，只可能在以下马匹中产生：

  * **A 组**：A2, A3, A4 (它们只输给过总冠军 A1，实力未知)
  * **B 组**：B1, B2, B3 (B1 输给 A1，B2, B3 输给 B1)
  * **C 组**：C1, C2 (C1 输给 A1, B1，C2 输给 C1)
  * **D 组**：D1 (D1 输给 A1, B1, C1)

**总共有 9 匹候选马，争夺剩下的 3 个名额。** 由于只有 8 条赛道，我们需要至少再比一场。

1.  **进行第 10 场比赛**：
    从 9 匹候选马中选出 8 匹进行比赛。一个明智的选择是让“最可能被淘汰”的马（即已知排名相对靠后的 D1）先不上场。

      * **参赛马匹**：A2, A3, A4, B1, B2, B3, C1, C2 (共8匹)
      * **场外观察**：D1

2.  **分析第 10 场比赛结果，决定是否需要第 11 场**：

      * **情况一：无需加赛（总计 10 场）**
        假设第 10 场比赛的前三名是 P1, P2, P3。总排名的 Top 4 就是 **{A1, P1, P2, P3}**。
        这个结论成立的前提是，我们必须确定场外等待的 D1 不可能比 P3 快。
        我们已知 A1 \> B1 \> C1 \> D1。如果 P3 是 C1 或者比 C1 更快的马（如 B1, B2, A2等），那么 P3 必然比 D1 快。在这种情况下，D1 被自然淘汰，无需再比。

          * **总结**：在第 10 场比赛中，只要其**前三名**里包含了所有比 D1 快的潜在对手（即 C1 必须进入前三，或者前三名都是 A 组和 B 组的马），那么这场比赛的前三名就锁定了 Top 4 的另外三席。

      * **情况二：需要加赛（总计 11 场）**
        如果在第 10 场比赛中，出现了 C1 没有进入前三的情况，比如前三名是 P1, P2, P3，而 P3 我们无法确定它一定比 D1 快（例如 P3 是 A4）。
        此时，总排名的第 4 名就在 P3 和 D1 之间产生。

          * **需要进行第 11 场比赛**：让 P3 和 D1 再比一次，胜者获得 Top 4 的最后一个席位。

-----

### **4. 最终结论**

  * **前 8 场**：分组初赛，必须进行。
  * **第 9 场**：小组冠军赛，必须进行。
  * **第 10 场**：从 9 匹候选马中选 8 匹进行决赛。
  * **第 11 场（可能）**：根据第 10 场的结果，可能需要一场附加赛来确定最后一个名额。

> **所以，最少需要 10 场或 11 场比赛，才能确保选出最快的 4 匹马。** 如果问题问的是“最少要多少次”，通常是指在最理想情况下的次数，即 **10 次**。如果问题是“保证能选出需要多少次”，那么答案是 **11 次**。

变式: 共25匹马, 5个赛道, 选出最快的3匹马
前五次选出前15名, 对第一名比, 选出前6名, 最后再比一轮, 共7轮